!function(r,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):r.router=e()}(this,function(){"use strict";var e,n,t,a,o,u,s,h,c,i,f,p,l,v,d,m,w,y,g,b,x,C,E;return e=window,n=void 0,s=null,h=/^#?\/*(.*?)\/*$/,c=":",i=e.location,f=decodeURIComponent,p=function(r){return r},l={hash:"",route:s},v={},d=function(r){return"function"==typeof r?r:n},m=function(r){switch(r){case"":case"#":return"#";case"/":case"#/":return"#/";default:return r.replace(h,"#/$1")}},w=function(r){for(var e,n=r.replace(h,"$1").split("/"),t=n.length;0<=--t;)(e=n[t])&&"#"!==e?e[0]!==c&&(n[t]=e.toLowerCase()):n.splice(t,1);return n},y=function(r,e,n){if(!r)return s;for(var t={},a=Object.keys(r),o=0;o<a.length;o++){var u=a[o];t[u]=r[u]}return t.hash=e,t.params=n,t},g=function(r,e,n){for(var t,a=r.replace(h,"$1").split("/"),o={},u=v,i=0;i<a.length;i++){if(!(u=u[t=(t=(r=n(a[i])).toLowerCase())in u?t:c in u?c:"*"]))return s;if("*"===t)break;u["~"]&&(o[u["~"]]=r)}return y(u["@"],e,o)},b=function(e,r){var n=m(e.path),t=v;return w(n).forEach(function(r){var e=r[0]===c,n=e?c:r;t=t[n]||(t[n]={}),e&&(t["~"]=r.slice(1))}),t=t["@"]={path:n,enter:r},Object.keys(e).forEach(function(r){"path"!==r&&(t[r]=e[r])}),u},x=function(r,e){return!!(r&&r.query&&(t=e,(n=r).path.toLowerCase()===t.path.toLowerCase()&&w(n.path).every(function(r){return!(r[0]===c&&(r=r.substr(1))&&n.params[r]!==t.params[r])}))&&!1===r.query(e.params))&&(l.hash=e.hash,l.route=e,!0);var n,t},C=function(r){if(r=m(r),l.hash.toLowerCase()!==r.toLowerCase()){var e=l.route,n=u.match(r);if(n&&x(e,n))return!1;if(e&&e.exit&&!1===e.exit(e.params))return!1;if(o&&o.call(u,e),l.hash=r,l.route=n,a&&a.call(u,n),n&&n.enter)return n.enter(n.params),!0;t&&r&&t.call(u,r)}return!1},E=function(){C(i.hash)},(u={add:function(r,e){return e=d(e),Array.isArray(r)?r.forEach(function(r){b(r,e)}):b(r,e),u},clear:function(){return v={},u},getContext:function(){var r=l.route;return r?y(r,r.hash,r.params):null},listen:function(r){if(!("onhashchange"in e))throw new Error("easyRouter: Your browser has no 'hashchange' support");return e.addEventListener("hashchange",E,!0),r=r&&m(r)||"#",t||(t=function(){i.hash=r}),i.hash?C(i.hash):i.hash=r,u},rescue:function(r){return t=d(r),u},reset:function(){return l.hash="",l.route=s,t=a=o=n,u.clear()},route:function(r){for(var e=w(m(r)),n=v,t=void 0,a=0;a<e.length&&n;a++)n=n[(t=e[a])[0]===c?c:t];return n&&n["@"]||s},match:function(r){var e=r.indexOf("%")<0?p:f,n=r.indexOf("?"),t=n<0?"":r.substr(n+1),a=n<0?r:r.substr(0,n);return t?function(r,e,n){if(r)for(var t=e.split("&"),a=0;a<t.length;a++){var o=t[a].split("=");r.params[n(o[0])]=n(o[1])}return r}(g(a,r,e),t,e):g(a,r,e)},navigate:function(r,e){return e&&(l.hash="@"),e&&m(i.hash)===m(r)?C(r):i.hash=r,u},onEnter:function(r){return a=d(r),u},onExit:function(r){return o=d(r),u},stop:function(){return e.removeEventListener("hashchange",E,!0),u}}).reset()});