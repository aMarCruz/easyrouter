!function(n,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):n.router=t()}(this,function(){"use strict";var t,r,e,a,o,u,c,s,f,i,h,l,p,v,d,m,g,w,y,E,x,b,C,L,O;return t=window,r=void 0,c=null,s=/^#?\/*(.*?)\/*$/,f=":",i="hashchange",h=decodeURIComponent,p=!(l=function(n){return n}),v="",d=c,m={},g=function(n){return"function"==typeof n?n:r},w=function(n){switch(n){case"":case"#":return"#";case"/":case"#/":return"#/";default:return n.replace(s,"#/$1")}},y=function(n){for(var t,r=n.replace(s,"$1").split("/"),e=r.length;0<=--e;)(t=r[e])&&"#"!==t?t[0]!==f&&(r[e]=t.toLowerCase()):r.splice(e,1);return r},E=function(n,t,r){if(!n)return c;for(var e={},a=Object.keys(n),o=0;o<a.length;o++){var u=a[o];e[u]=n[u]}return e.hash=t,e.params=r,e},x=function(n,t,r){for(var e,a=n.replace(s,"$1").split("/").filter(Boolean),o={},u=m,i=0;i<a.length;i++){if(!(u=u[e=(e=(n=r(a[i])).toLowerCase())in u?e:f in u?f:"*"]))return c;if("*"===e)break;u["~"]&&(o[u["~"]]=n)}return E(u["@"],t,o)},b=function(t,n){var r=w(t.path),e=m;return y(r).forEach(function(n){var t=n[0]===f,r=t?f:n;e=e[r]||(e[r]={}),t&&(e["~"]=n.slice(1))}),e=e["@"]={path:r,enter:n},Object.keys(t).forEach(function(n){"path"!==n&&(e[n]=t[n])}),u},C=function(n,t){return!!(n&&n.query&&(e=t,(r=n).path.toLowerCase()===e.path.toLowerCase()&&y(r.path).every(function(n){return!(n[0]===f&&(n=n.substr(1))&&r.params[n]!==e.params[n])}))&&!1===n.query(t.params))&&(u.navigate(n.hash),!0);var r,e},L=function(n){if(n=w(n),v.toLowerCase()!==n.toLowerCase()){var t=d,r=u.match(n);if(r&&C(t,r))return!1;if(t&&t.exit&&!1===t.exit(t.params))return!1;if(o&&o.call(u,t),v=n,d=r,a&&a.call(u,r),r&&r.enter)return r.enter(r.params),!0;e&&n&&e.call(u,n)}return!1},O=function(){return L(location.hash)},(u={add:function(n,t){return t=g(t),Array.isArray(n)?n.forEach(function(n){b(n,t)}):b(n,t),u},clear:function(){return m={},u},getContext:function(){var n=d;return{isActive:p,lastHash:v,lastRoute:n?E(n,n.hash,n.params):null,onEnter:a,onExit:o,rescue:e}},listen:function(n){if(!("onhashchange"in t))throw new Error("easyRouter: Your browser has no 'hashchange' support");return u.stop(),t.addEventListener(i,O,!0),n=n&&w(n)||"#",e||(e=function(){u.navigate(n)}),location.hash?L(location.hash):u.navigate(n),p=!0,u},match:function(n){var t=n.indexOf("%")<0?l:h,r=n.indexOf("?"),e=r<0?"":n.substr(r+1),a=r<0?n:n.substr(0,r);return e?function(n,t,r){if(n)for(var e=t.split("&"),a=0;a<e.length;a++){var o=e[a].split("=");n.params[r(o[0])]=r(o[1])}return n}(x(a,n,t),e,t):x(a,n,t)},navigate:function(n,t){return t&&(v="@"),t&&w(location.hash)===w(n)?L(n):location.hash=n,u},onEnter:function(n){return a=g(n),u},onExit:function(n){return o=g(n),u},rescue:function(n){return e=g(n),u},reset:function(){return v="",d=c,e=a=o=r,u.clear()},route:function(n){for(var t=y(w(n)),r=m,e=void 0,a=0;a<t.length&&r;a++)r=r[(e=t[a])[0]===f?f:e];return r&&r["@"]||c},stop:function(){return p=!1,t.removeEventListener(i,O,!0),u}}).reset()});