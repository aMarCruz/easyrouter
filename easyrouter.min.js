!function(n,r){"object"==typeof exports&&"undefined"!=typeof module?module.exports=r():"function"==typeof define&&define.amd?define(r):n.router=r()}(this,function(){"use strict";var r,t,e,a,o,u,s,c,f,i,h,l,p,v,d,m,g,w,y,E,x,b,C,L,O,R;return r=window,t=void 0,s=null,c=/^#?\/*(.*?)\/*$/,f=":",i="hashchange",h=decodeURIComponent,p=!(l=function(n){return n}),v="",m=d=s,g={},w=function(n){return"function"==typeof n?n:t},y=function(n){switch(n){case"":case"#":return"#";case"/":case"#/":return"#/";default:return n.replace(c,"#/$1")}},E=function(n){for(var r,t=n.replace(c,"$1").split("/"),e=t.length;0<=--e;)(r=t[e])&&"#"!==r?r[0]!==f&&(t[e]=r.toLowerCase()):t.splice(e,1);return t},x=function(n,r,t){if(!n)return s;for(var e={},a=Object.keys(n),o=0;o<a.length;o++){var u=a[o];e[u]=n[u]}return e.hash=r,e.params=t,e},b=function(n,r,t){for(var e,a=n.replace(c,"$1").split("/").filter(Boolean),o={},u=g,i=0;i<a.length;i++){if(!(u=u[e=(e=(n=t(a[i])).toLowerCase())in u?e:f in u?f:"*"]))return s;if("*"===e)break;u["~"]&&(o[u["~"]]=n)}return x(u["@"],r,o)},C=function(r,n){var t=y(r.path),e=g;return E(t).forEach(function(n){var r=n[0]===f,t=r?f:n;e=e[t]||(e[t]={}),r&&(e["~"]=n.slice(1))}),e=e["@"]={path:t,enter:n},Object.keys(r).forEach(function(n){"path"!==n&&(e[n]=r[n])}),u},L=function(n,r){return!!(n&&n.query&&(e=r,(t=n).path.toLowerCase()===e.path.toLowerCase()&&E(t.path).every(function(n){return!(n[0]===f&&(n=n.substr(1))&&t.params[n]!==e.params[n])}))&&!1===n.query(r.params))&&(u.navigate(n.hash),!0);var t,e},O=function(n){if(n=y(n),v.toLowerCase()!==n.toLowerCase()){var r=m,t=u.match(n);if(t&&L(r,t))return!1;if(r&&r.exit&&!1===r.exit(r.params))return!1;if(o&&o.call(u,r,t),v=n,d=r,m=t,a&&a.call(u,t,r),t&&t.enter)return t.enter(t.params),!0;e&&n&&e.call(u,n)}return!1},R=function(){return O(location.hash)},(u={add:function(n,r){return r=w(r),Array.isArray(n)?n.forEach(function(n){C(n,r)}):C(n,r),u},clear:function(){return g={},u},getContext:function(){var n=m,r=d;return{isActive:p,lastHash:v,lastRoute:n?x(n,n.hash,n.params):null,prevRoute:r?x(r,r.hash,r.params):null,onEnter:a,onExit:o,rescue:e}},listen:function(n){if(!("onhashchange"in r))throw new Error("easyRouter: Your browser has no 'hashchange' support");return u.stop(),r.addEventListener(i,R,!0),n=n&&y(n)||"#",e||(e=function(){u.navigate(n)}),location.hash?O(location.hash):u.navigate(n),p=!0,u},match:function(n){var r=n.indexOf("%")<0?l:h,t=n.indexOf("?"),e=t<0?"":n.substr(t+1),a=t<0?n:n.substr(0,t);return e?function(n,r,t){if(n)for(var e=r.split("&"),a=0;a<e.length;a++){var o=e[a].split("=");n.params[t(o[0])]=t(o[1])}return n}(b(a,n,r),e,r):b(a,n,r)},navigate:function(n,r){return r&&(v="@"),r&&y(location.hash)===y(n)?O(n):location.hash=n,u},onEnter:function(n){return a=w(n),u},onExit:function(n){return o=w(n),u},rescue:function(n){return e=w(n),u},reset:function(){return v="",m=s,e=a=o=t,u.clear()},route:function(n){for(var r=E(y(n)),t=g,e=void 0,a=0;a<r.length&&t;a++)t=t[(e=r[a])[0]===f?f:e];return t&&t["@"]||s},stop:function(){return p=!1,r.removeEventListener(i,R,!0),u}}).reset()});