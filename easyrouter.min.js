!function(n,r){"object"==typeof exports&&"undefined"!=typeof module?module.exports=r():"function"==typeof define&&define.amd?define(r):n.router=r()}(this,function(){"use strict";var r,a,t,c,s,f,e,o,u,i,h,l,p,v,d,m,g,w,y,E,x,b,C,L,O,R;return r=window,s=/^#?\/*(.*?)\/*$/,f=":",o=!(e="hashchange"),u="",h=i=c=null,l={},d=v=p=t=void 0,m=decodeURIComponent,g=function(n){return n},w=function(n){return"function"==typeof n?n:t},y=function(n){switch(n){case"":case"#":return"#";case"/":case"#/":return"#/";default:return n.replace(s,"#/$1")}},E=function(n){for(var r,t=n.replace(s,"$1").split("/"),e=t.length;0<=--e;)(r=t[e])&&"#"!==r?r[0]!==f&&(t[e]=r.toLowerCase()):t.splice(e,1);return t},x=function(n,r,t){if(!n)return c;for(var e={},a=Object.keys(n),o=0;o<a.length;o++){var u=a[o];e[u]=n[u]}return e.hash=r,e.params=t,e},b=function(n,r,t){for(var e,a=n.replace(s,"$1").split("/").filter(Boolean),o={},u=l,i=0;i<a.length;i++){if(!(u=u[e=(e=(n=t(a[i])).toLowerCase())in u?e:f in u?f:"*"]))return c;if("*"===e)break;u["~"]&&(o[u["~"]]=n)}return x(u["@"],r,o)},C=function(r,n){var t=y(r.path),e=l;return E(t).forEach(function(n){var r=n[0]===f,t=r?f:n;e=e[t]||(e[t]={}),r&&(e["~"]=n.slice(1))}),e=e["@"]={path:t,enter:n},Object.keys(r).forEach(function(n){"path"!==n&&(e[n]=r[n])}),a},L=function(n,r){return!!(n&&n.query&&(e=r,(t=n).path.toLowerCase()===e.path.toLowerCase()&&E(t.path).every(function(n){return!(n[0]===f&&(n=n.substr(1))&&t.params[n]!==e.params[n])}))&&!1===n.query(r.params))&&(a.navigate(n.hash),!0);var t,e},O=function(n){if(n=y(n),u.toLowerCase()!==n.toLowerCase()){var r=h,t=a.match(n);if(t&&L(r,t))return!1;if(r&&r.exit&&!1===r.exit(r.params))return!1;if(d&&d.call(a,r,t),u=n,i=r,h=t,v&&v.call(a,t,r),t&&t.enter)return t.enter(t.params),!0;p&&n&&p.call(a,n)}return!1},R=function(){return O(location.hash)},a={add:function(n,r){return r=w(r),Array.isArray(n)?n.forEach(function(n){C(n,r)}):C(n,r),a},clear:function(){return l={},a},getContext:function(){var n=h,r=i;return{isActive:o,lastHash:u,lastRoute:n?x(n,n.hash,n.params):null,prevRoute:r?x(r,r.hash,r.params):null,onEnter:v,onExit:d,rescue:p}},listen:function(n){if(!("onhashchange"in r))throw new Error("easyRouter: Your browser has no 'hashchange' support");return a.stop(),r.addEventListener(e,R,!0),n=n&&y(n)||"#",p||(p=function(){a.navigate(n)}),location.hash?O(location.hash):a.navigate(n),o=!0,a},match:function(n){var r=n.indexOf("%")<0?g:m,t=n.indexOf("?"),e=t<0?"":n.substr(t+1),a=t<0?n:n.substr(0,t);return e?function(n,r,t){if(n)for(var e=r.split("&"),a=0;a<e.length;a++){var o=e[a].split("=");n.params[t(o[0])]=t(o[1])}return n}(b(a,n,r),e,r):b(a,n,r)},navigate:function(n,r){return r&&(u="@"),r&&y(location.hash)===y(n)?O(n):location.hash=n,a},onEnter:function(n){return v=w(n),a},onExit:function(n){return d=w(n),a},rescue:function(n){return p=w(n),a},reset:function(){return u="",i=h=c,p=v=d=t,a.clear()},route:function(n){for(var r=E(y(n)),t=l,e=void 0,a=0;a<r.length&&t;a++)t=t[(e=r[a])[0]===f?f:e];return t&&t["@"]||c},stop:function(){return o=!1,r.removeEventListener(e,R,!0),a}}});