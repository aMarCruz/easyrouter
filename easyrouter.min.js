!function(n,r){"object"==typeof exports&&"undefined"!=typeof module?module.exports=r():"function"==typeof define&&define.amd?define(r):n.router=r()}(this,function(){"use strict";var r,t,e,a,o,u,c,s,f,i,h,l,p,v,d,m,g,w,y,E,x,b,C,L,O;return r=window,t=void 0,c=null,s=/^#?\/*(.*?)\/*$/,f=":",i="hashchange",h=decodeURIComponent,p=!(l=function(n){return n}),v="",d=c,m={},g=function(n){return"function"==typeof n?n:t},w=function(n){switch(n){case"":case"#":return"#";case"/":case"#/":return"#/";default:return n.replace(s,"#/$1")}},y=function(n){for(var r,t=n.replace(s,"$1").split("/"),e=t.length;0<=--e;)(r=t[e])&&"#"!==r?r[0]!==f&&(t[e]=r.toLowerCase()):t.splice(e,1);return t},E=function(n,r,t){if(!n)return c;for(var e={},a=Object.keys(n),o=0;o<a.length;o++){var u=a[o];e[u]=n[u]}return e.hash=r,e.params=t,e},x=function(n,r,t){for(var e,a=n.replace(s,"$1").split("/"),o={},u=m,i=0;i<a.length;i++){if(!(u=u[e=(e=(n=t(a[i])).toLowerCase())in u?e:f in u?f:"*"]))return c;if("*"===e)break;u["~"]&&(o[u["~"]]=n)}return E(u["@"],r,o)},b=function(r,n){var t=w(r.path),e=m;return y(t).forEach(function(n){var r=n[0]===f,t=r?f:n;e=e[t]||(e[t]={}),r&&(e["~"]=n.slice(1))}),e=e["@"]={path:t,enter:n},Object.keys(r).forEach(function(n){"path"!==n&&(e[n]=r[n])}),u},C=function(n,r){return!!(n&&n.query&&(e=r,(t=n).path.toLowerCase()===e.path.toLowerCase()&&y(t.path).every(function(n){return!(n[0]===f&&(n=n.substr(1))&&t.params[n]!==e.params[n])}))&&!1===n.query(r.params))&&(u.navigate(n.hash),!0);var t,e},L=function(n){if(n=w(n),v.toLowerCase()!==n.toLowerCase()){var r=d,t=u.match(n);if(t&&C(r,t))return!1;if(r&&r.exit&&!1===r.exit(r.params))return!1;if(o&&o.call(u,r),v=n,d=t,a&&a.call(u,t),t&&t.enter)return t.enter(t.params),!0;e&&n&&e.call(u,n)}return!1},O=function(){return L(location.hash)},(u={add:function(n,r){return r=g(r),Array.isArray(n)?n.forEach(function(n){b(n,r)}):b(n,r),u},clear:function(){return m={},u},getContext:function(){var n=d;return{isActive:p,lastHash:v,lastRoute:n?E(n,n.hash,n.params):null,onEnter:a,onExit:o,rescue:e}},listen:function(n){if(!("onhashchange"in r))throw new Error("easyRouter: Your browser has no 'hashchange' support");return u.stop(),r.addEventListener(i,O,!0),n=n&&w(n)||"#",e||(e=function(){u.navigate(n)}),location.hash?L(location.hash):u.navigate(n),p=!0,u},rescue:function(n){return e=g(n),u},reset:function(){return v="",d=c,e=a=o=t,u.clear()},route:function(n){for(var r=y(w(n)),t=m,e=void 0,a=0;a<r.length&&t;a++)t=t[(e=r[a])[0]===f?f:e];return t&&t["@"]||c},match:function(n){var r=n.indexOf("%")<0?l:h,t=n.indexOf("?"),e=t<0?"":n.substr(t+1),a=t<0?n:n.substr(0,t);return e?function(n,r,t){if(n)for(var e=r.split("&"),a=0;a<e.length;a++){var o=e[a].split("=");n.params[t(o[0])]=t(o[1])}return n}(x(a,n,r),e,r):x(a,n,r)},navigate:function(n,r){return r&&(v="@"),r&&w(location.hash)===w(n)?L(n):location.href=n,u},onEnter:function(n){return a=g(n),u},onExit:function(n){return o=g(n),u},stop:function(){return p=!1,r.removeEventListener(i,O,!0),u}}).reset()});